<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.dxjr.portal.borrow.mapper.TenderRecordMapper" >
  <resultMap id="BaseResultMap" type="com.dxjr.portal.borrow.entity.TenderRecord" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 19 14:13:32 CST 2014.
    -->
    <id column="ID" property="id" jdbcType="INTEGER" />
    <result column="USER_ID" property="userId" jdbcType="INTEGER" />
    <result column="BORROW_ID" property="borrowId" jdbcType="INTEGER" />
    <result column="STATUS" property="status" jdbcType="INTEGER" />
    <result column="ACCOUNT" property="account" jdbcType="DECIMAL" />
    <result column="INTEREST" property="interest" jdbcType="DECIMAL" />
    <result column="REPAYMENT_ACCOUNT" property="repaymentAccount" jdbcType="DECIMAL" />
    <result column="REPAYMENT_YESACCOUNT" property="repaymentYesaccount" jdbcType="DECIMAL" />
    <result column="REPAYMENT_YESINTEREST" property="repaymentYesinterest" jdbcType="DECIMAL" />
    <result column="ADDTIME" property="addtime" jdbcType="VARCHAR" />
    <result column="ADDIP" property="addip" jdbcType="VARCHAR" />
    <result column="TENDER_TYPE" property="tenderType" jdbcType="INTEGER" />
    <result column="AUTOTENDER_ORDER" property="autotenderOrder" jdbcType="INTEGER" />
    <result column="AUTOTENDER_ORDER_REMARK" property="autotenderOrderRemark" jdbcType="VARCHAR" />
    <result column="FIRST_BORROW_ID" property="firstBorrowId" jdbcType="INTEGER" />
    <result column="FIRST_BORROW_SCALE" property="firstBorrowScale" jdbcType="VARCHAR" />
    <result column="USER_LEVEL" property="userLevel" jdbcType="VARCHAR" />
    <result column="RATIO" property="ratio" jdbcType="VARCHAR" />
    <result column="AUTO_TYPE" property="autoType" jdbcType="INTEGER" />
    <result column="E_FREEZE_No" 			property="eFreezeNo"/>
    <result column="E_BANKINFO_ID" 			property="eBankInfoId"/>
    <result column="E_FREEZE_DATE" 			property="eFreezeDate"/>
    <result column="IS_CUSTODY" 			property="isCustody"/>
    <result column="BIZ_INVEST_NO" 			property="bizInvestNo"/>
    <result column="E_INVEST_DATE"		 	property="eInvestDate"/>
    <result column="E_INVEST_No" 			property="eInvestNo"/>
    <result column="E_INVEST_STATUS" 		property="eInvestStatus"/>
  </resultMap>
  

  
  <sql id="Example_Where_Clause" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 19 14:13:32 CST 2014.
    -->
    <where >
      <foreach collection="oredCriteria" item="criteria" separator="or" >
        <if test="criteria.valid" >
          <trim prefix="(" suffix=")" prefixOverrides="and" >
            <foreach collection="criteria.criteria" item="criterion" >
              <choose >
                <when test="criterion.noValue" >
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue" >
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue" >
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue" >
                  and ${criterion.condition}
                  <foreach collection="criterion.value" item="listItem" open="(" close=")" separator="," >
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Update_By_Example_Where_Clause" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 19 14:13:32 CST 2014.
    -->
    <where >
      <foreach collection="example.oredCriteria" item="criteria" separator="or" >
        <if test="criteria.valid" >
          <trim prefix="(" suffix=")" prefixOverrides="and" >
            <foreach collection="criteria.criteria" item="criterion" >
              <choose >
                <when test="criterion.noValue" >
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue" >
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue" >
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue" >
                  and ${criterion.condition}
                  <foreach collection="criterion.value" item="listItem" open="(" close=")" separator="," >
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 19 14:13:32 CST 2014.
    -->
    ID, USER_ID, BORROW_ID, STATUS, ACCOUNT, INTEREST, REPAYMENT_ACCOUNT, REPAYMENT_YESACCOUNT, 
    REPAYMENT_YESINTEREST, ADDTIME, ADDIP, TENDER_TYPE, AUTOTENDER_ORDER, AUTOTENDER_ORDER_REMARK, 
    FIRST_BORROW_ID, FIRST_BORROW_SCALE, USER_LEVEL, RATIO
  </sql>
  <select id="selectByExample" resultMap="BaseResultMap" parameterType="com.dxjr.portal.borrow.entity.TenderRecordExample" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 19 14:13:32 CST 2014.
    -->
    select
    <if test="distinct" >
      distinct
    </if>
    <include refid="Base_Column_List" />
    from rocky_b_tenderrecord
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null" >
      order by ${orderByClause}
    </if>
  </select>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 19 14:13:32 CST 2014.
    -->
    select 
    <include refid="Base_Column_List" />
    from rocky_b_tenderrecord
    where ID = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 19 14:13:32 CST 2014.
    -->
    delete from rocky_b_tenderrecord
    where ID = #{id,jdbcType=INTEGER}
  </delete>
  <delete id="deleteByExample" parameterType="com.dxjr.portal.borrow.entity.TenderRecordExample" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 19 14:13:32 CST 2014.
    -->
    delete from rocky_b_tenderrecord
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
  </delete>
  <insert id="insert" parameterType="com.dxjr.portal.borrow.entity.TenderRecord" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 19 14:13:32 CST 2014.
    -->
    insert into rocky_b_tenderrecord (ID, USER_ID, BORROW_ID, 
      STATUS, ACCOUNT, INTEREST, 
      REPAYMENT_ACCOUNT, REPAYMENT_YESACCOUNT, REPAYMENT_YESINTEREST, 
      ADDTIME, ADDIP, TENDER_TYPE, 
      AUTOTENDER_ORDER, AUTOTENDER_ORDER_REMARK, 
      FIRST_BORROW_ID, FIRST_BORROW_SCALE, USER_LEVEL, 
      RATIO)
    values (#{id,jdbcType=INTEGER}, #{userId,jdbcType=INTEGER}, #{borrowId,jdbcType=INTEGER}, 
      #{status,jdbcType=INTEGER}, #{account,jdbcType=DECIMAL}, #{interest,jdbcType=DECIMAL}, 
      #{repaymentAccount,jdbcType=DECIMAL}, #{repaymentYesaccount,jdbcType=DECIMAL}, #{repaymentYesinterest,jdbcType=DECIMAL}, 
      #{addtime,jdbcType=VARCHAR}, #{addip,jdbcType=VARCHAR}, #{tenderType,jdbcType=INTEGER}, 
      #{autotenderOrder,jdbcType=INTEGER}, #{autotenderOrderRemark,jdbcType=VARCHAR}, 
      #{firstBorrowId,jdbcType=INTEGER}, #{firstBorrowScale,jdbcType=VARCHAR}, #{userLevel,jdbcType=VARCHAR}, 
      #{ratio,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.dxjr.portal.borrow.entity.TenderRecord" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 19 14:13:32 CST 2014.
    -->
    insert into rocky_b_tenderrecord
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        ID,
      </if>
      <if test="userId != null" >
        USER_ID,
      </if>
      <if test="borrowId != null" >
        BORROW_ID,
      </if>
      <if test="status != null" >
        STATUS,
      </if>
      <if test="account != null" >
        ACCOUNT,
      </if>
      <if test="interest != null" >
        INTEREST,
      </if>
      <if test="repaymentAccount != null" >
        REPAYMENT_ACCOUNT,
      </if>
      <if test="repaymentYesaccount != null" >
        REPAYMENT_YESACCOUNT,
      </if>
      <if test="repaymentYesinterest != null" >
        REPAYMENT_YESINTEREST,
      </if>
      <if test="addtime != null" >
        ADDTIME,
      </if>
      <if test="addip != null" >
        ADDIP,
      </if>
      <if test="tenderType != null" >
        TENDER_TYPE,
      </if>
      <if test="autotenderOrder != null " >
        AUTOTENDER_ORDER,
      </if>
      <if test="autotenderOrderRemark != null" >
        AUTOTENDER_ORDER_REMARK,
      </if>
      <if test="firstBorrowId != null" >
        FIRST_BORROW_ID,
      </if>
      <if test="firstBorrowScale != null" >
        FIRST_BORROW_SCALE,
      </if>
      <if test="userLevel != null" >
        USER_LEVEL,
      </if>
      <if test="ratio != null" >
        RATIO,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=INTEGER},
      </if>
      <if test="userId != null" >
        #{userId,jdbcType=INTEGER},
      </if>
      <if test="borrowId != null" >
        #{borrowId,jdbcType=INTEGER},
      </if>
      <if test="status != null" >
        #{status,jdbcType=INTEGER},
      </if>
      <if test="account != null" >
        #{account,jdbcType=DECIMAL},
      </if>
      <if test="interest != null" >
        #{interest,jdbcType=DECIMAL},
      </if>
      <if test="repaymentAccount != null" >
        #{repaymentAccount,jdbcType=DECIMAL},
      </if>
      <if test="repaymentYesaccount != null" >
        #{repaymentYesaccount,jdbcType=DECIMAL},
      </if>
      <if test="repaymentYesinterest != null" >
        #{repaymentYesinterest,jdbcType=DECIMAL},
      </if>
      <if test="addtime != null" >
        #{addtime,jdbcType=VARCHAR},
      </if>
      <if test="addip != null" >
        #{addip,jdbcType=VARCHAR},
      </if>
      <if test="tenderType != null" >
        #{tenderType,jdbcType=INTEGER},
      </if>
      <if test="autotenderOrder != null" >
        #{autotenderOrder,jdbcType=INTEGER},
      </if>
      <if test="autotenderOrderRemark != null" >
        #{autotenderOrderRemark,jdbcType=VARCHAR},
      </if>
      <if test="firstBorrowId != null" >
        #{firstBorrowId,jdbcType=INTEGER},
      </if>
      <if test="firstBorrowScale != null" >
        #{firstBorrowScale,jdbcType=VARCHAR},
      </if>
      <if test="userLevel != null" >
        #{userLevel,jdbcType=VARCHAR},
      </if>
      <if test="ratio != null" >
        #{ratio,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <select id="countByExample" parameterType="com.dxjr.portal.borrow.entity.TenderRecordExample" resultType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 19 14:13:32 CST 2014.
    -->
    select count(*) from rocky_b_tenderrecord
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
  </select>
  <update id="updateByExampleSelective" parameterType="map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 19 14:13:32 CST 2014.
    -->
    update rocky_b_tenderrecord
    <set >
      <if test="record.id != null" >
        ID = #{record.id,jdbcType=INTEGER},
      </if>
      <if test="record.userId != null" >
        USER_ID = #{record.userId,jdbcType=INTEGER},
      </if>
      <if test="record.borrowId != null" >
        BORROW_ID = #{record.borrowId,jdbcType=INTEGER},
      </if>
      <if test="record.status != null" >
        STATUS = #{record.status,jdbcType=INTEGER},
      </if>
      <if test="record.account != null" >
        ACCOUNT = #{record.account,jdbcType=DECIMAL},
      </if>
      <if test="record.interest != null" >
        INTEREST = #{record.interest,jdbcType=DECIMAL},
      </if>
      <if test="record.repaymentAccount != null" >
        REPAYMENT_ACCOUNT = #{record.repaymentAccount,jdbcType=DECIMAL},
      </if>
      <if test="record.repaymentYesaccount != null" >
        REPAYMENT_YESACCOUNT = #{record.repaymentYesaccount,jdbcType=DECIMAL},
      </if>
      <if test="record.repaymentYesinterest != null" >
        REPAYMENT_YESINTEREST = #{record.repaymentYesinterest,jdbcType=DECIMAL},
      </if>
      <if test="record.addtime != null" >
        ADDTIME = #{record.addtime,jdbcType=VARCHAR},
      </if>
      <if test="record.addip != null" >
        ADDIP = #{record.addip,jdbcType=VARCHAR},
      </if>
      <if test="record.tenderType != null" >
        TENDER_TYPE = #{record.tenderType,jdbcType=INTEGER},
      </if>
      <if test="record.autotenderOrder != null" >
        AUTOTENDER_ORDER = #{record.autotenderOrder,jdbcType=INTEGER},
      </if>
      <if test="record.autotenderOrderRemark != null" >
        AUTOTENDER_ORDER_REMARK = #{record.autotenderOrderRemark,jdbcType=VARCHAR},
      </if>
      <if test="record.firstBorrowId != null" >
        FIRST_BORROW_ID = #{record.firstBorrowId,jdbcType=INTEGER},
      </if>
      <if test="record.firstBorrowScale != null" >
        FIRST_BORROW_SCALE = #{record.firstBorrowScale,jdbcType=VARCHAR},
      </if>
      <if test="record.userLevel != null" >
        USER_LEVEL = #{record.userLevel,jdbcType=VARCHAR},
      </if>
      <if test="record.ratio != null" >
        RATIO = #{record.ratio,jdbcType=VARCHAR},
      </if>
    </set>
    <if test="_parameter != null" >
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByExample" parameterType="map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 19 14:13:32 CST 2014.
    -->
    update rocky_b_tenderrecord
    set ID = #{record.id,jdbcType=INTEGER},
      USER_ID = #{record.userId,jdbcType=INTEGER},
      BORROW_ID = #{record.borrowId,jdbcType=INTEGER},
      STATUS = #{record.status,jdbcType=INTEGER},
      ACCOUNT = #{record.account,jdbcType=DECIMAL},
      INTEREST = #{record.interest,jdbcType=DECIMAL},
      REPAYMENT_ACCOUNT = #{record.repaymentAccount,jdbcType=DECIMAL},
      REPAYMENT_YESACCOUNT = #{record.repaymentYesaccount,jdbcType=DECIMAL},
      REPAYMENT_YESINTEREST = #{record.repaymentYesinterest,jdbcType=DECIMAL},
      ADDTIME = #{record.addtime,jdbcType=VARCHAR},
      ADDIP = #{record.addip,jdbcType=VARCHAR},
      TENDER_TYPE = #{record.tenderType,jdbcType=INTEGER},
      AUTOTENDER_ORDER = #{record.autotenderOrder,jdbcType=INTEGER},
      AUTOTENDER_ORDER_REMARK = #{record.autotenderOrderRemark,jdbcType=VARCHAR},
      FIRST_BORROW_ID = #{record.firstBorrowId,jdbcType=INTEGER},
      FIRST_BORROW_SCALE = #{record.firstBorrowScale,jdbcType=VARCHAR},
      USER_LEVEL = #{record.userLevel,jdbcType=VARCHAR},
      RATIO = #{record.ratio,jdbcType=VARCHAR}
    <if test="_parameter != null" >
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByPrimaryKeySelective" parameterType="com.dxjr.portal.borrow.entity.TenderRecord" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 19 14:13:32 CST 2014.
    -->
    update rocky_b_tenderrecord
    <set >
      <if test="userId != null" >
        USER_ID = #{userId,jdbcType=INTEGER},
      </if>
      <if test="borrowId != null" >
        BORROW_ID = #{borrowId,jdbcType=INTEGER},
      </if>
      <if test="status != null" >
        STATUS = #{status,jdbcType=INTEGER},
      </if>
      <if test="account != null" >
        ACCOUNT = #{account,jdbcType=DECIMAL},
      </if>
      <if test="interest != null" >
        INTEREST = #{interest,jdbcType=DECIMAL},
      </if>
      <if test="repaymentAccount != null" >
        REPAYMENT_ACCOUNT = #{repaymentAccount,jdbcType=DECIMAL},
      </if>
      <if test="repaymentYesaccount != null" >
        REPAYMENT_YESACCOUNT = #{repaymentYesaccount,jdbcType=DECIMAL},
      </if>
      <if test="repaymentYesinterest != null" >
        REPAYMENT_YESINTEREST = #{repaymentYesinterest,jdbcType=DECIMAL},
      </if>
      <if test="addtime != null" >
        ADDTIME = #{addtime,jdbcType=VARCHAR},
      </if>
      <if test="addip != null" >
        ADDIP = #{addip,jdbcType=VARCHAR},
      </if>
      <if test="tenderType != null" >
        TENDER_TYPE = #{tenderType,jdbcType=INTEGER},
      </if>
      <if test="autotenderOrder != null" >
        AUTOTENDER_ORDER = #{autotenderOrder,jdbcType=INTEGER},
      </if>
      <if test="autotenderOrderRemark != null" >
        AUTOTENDER_ORDER_REMARK = #{autotenderOrderRemark,jdbcType=VARCHAR},
      </if>
      <if test="firstBorrowId != null" >
        FIRST_BORROW_ID = #{firstBorrowId,jdbcType=INTEGER},
      </if>
      <if test="firstBorrowScale != null" >
        FIRST_BORROW_SCALE = #{firstBorrowScale,jdbcType=VARCHAR},
      </if>
      <if test="userLevel != null" >
        USER_LEVEL = #{userLevel,jdbcType=VARCHAR},
      </if>
      <if test="ratio != null" >
        RATIO = #{ratio,jdbcType=VARCHAR},
      </if>
    </set>
    where ID = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.dxjr.portal.borrow.entity.TenderRecord" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 19 14:13:32 CST 2014.
    -->
    update rocky_b_tenderrecord
    set USER_ID = #{userId,jdbcType=INTEGER},
      BORROW_ID = #{borrowId,jdbcType=INTEGER},
      STATUS = #{status,jdbcType=INTEGER},
      ACCOUNT = #{account,jdbcType=DECIMAL},
      INTEREST = #{interest,jdbcType=DECIMAL},
      REPAYMENT_ACCOUNT = #{repaymentAccount,jdbcType=DECIMAL},
      REPAYMENT_YESACCOUNT = #{repaymentYesaccount,jdbcType=DECIMAL},
      REPAYMENT_YESINTEREST = #{repaymentYesinterest,jdbcType=DECIMAL},
      ADDTIME = #{addtime,jdbcType=VARCHAR},
      ADDIP = #{addip,jdbcType=VARCHAR},
      TENDER_TYPE = #{tenderType,jdbcType=INTEGER},
      AUTOTENDER_ORDER = #{autotenderOrder,jdbcType=VARCHAR},
      AUTOTENDER_ORDER_REMARK = #{autotenderOrderRemark,jdbcType=VARCHAR},
      FIRST_BORROW_ID = #{firstBorrowId,jdbcType=INTEGER},
      FIRST_BORROW_SCALE = #{firstBorrowScale,jdbcType=VARCHAR},
      USER_LEVEL = #{userLevel,jdbcType=VARCHAR},
      RATIO = #{ratio,jdbcType=VARCHAR}
    where ID = #{id,jdbcType=INTEGER}
  </update>
  
  <select id="selectByUserIdAndBorrowId" resultMap="BaseResultMap" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 19 14:13:32 CST 2014.
    -->
    select
    <include refid="Base_Column_List" />
    from rocky_b_tenderrecord
   	where USER_ID = #{userId,jdbcType=INTEGER} and BORROW_ID= #{borrowId,jdbcType=INTEGER}
  </select>
  
  <!-- 根据标ID、用户ID、自动投标排名查询自动投标记录 -->
  <select id="queryTenderRecordForAutoTender" resultMap="BaseResultMap" >
    select
    <include refid="Base_Column_List" />
    from rocky_b_tenderrecord
   	WHERE borrow_id = #{borrowId,jdbcType=INTEGER} and user_id = #{userId,jdbcType=INTEGER} and autotender_order = #{autotenderOrder,jdbcType=INTEGER} and tender_type = 1 order by addtime desc limit 0,1
  </select>

  <resultMap id="tenderRecordVoResultMap" type="com.dxjr.portal.borrow.vo.TenderRecordVo" >
    <id column="ID" property="id" jdbcType="INTEGER" />
    <result column="USER_ID" property="userId" jdbcType="INTEGER" />
    <result column="BORROW_ID" property="borrowId" jdbcType="INTEGER" />
    <result column="STATUS" property="status" jdbcType="INTEGER" />
    <result column="ACCOUNT" property="account" jdbcType="DECIMAL" />
    <result column="INTEREST" property="interest" jdbcType="DECIMAL" />
    <result column="REPAYMENT_ACCOUNT" property="repaymentAccount" jdbcType="DECIMAL" />
    <result column="REPAYMENT_YESACCOUNT" property="repaymentYesaccount" jdbcType="DECIMAL" />
    <result column="REPAYMENT_YESINTEREST" property="repaymentYesinterest" jdbcType="DECIMAL" />
    <result column="ADDTIME" property="addtime" jdbcType="VARCHAR" />
    <result column="ADDIP" property="addip" jdbcType="VARCHAR" />
    <result column="TENDER_TYPE" property="tenderType" jdbcType="INTEGER" />
    <result column="AUTOTENDER_ORDER" property="autotenderOrder" jdbcType="INTEGER" />
    <result column="AUTOTENDER_ORDER_REMARK" property="autotenderOrderRemark" jdbcType="VARCHAR" />
    <result column="FIRST_BORROW_ID" property="firstBorrowId" jdbcType="INTEGER" />
    <result column="FIRST_BORROW_SCALE" property="firstBorrowScale" jdbcType="VARCHAR" />
    <result column="USER_LEVEL" property="userLevel" jdbcType="VARCHAR" />
    <result column="RATIO" property="ratio" jdbcType="VARCHAR" />
    <result column="email" property="email" jdbcType="VARCHAR" />
    <result column="username" property="username" jdbcType="VARCHAR" />
    <result column="firstBorrowName" property="firstBorrowName" jdbcType="VARCHAR" />
    <result column="ADDTIME_Date" property="addtimeDate" />
    <result column="tenderCapital" property="tenderCapital" jdbcType="DECIMAL" />
    <result column="tenderInterest" property="tenderInterest" jdbcType="DECIMAL" />
    <result column="tenderRepayAccount" property="tenderRepayAccount" jdbcType="DECIMAL" />
    <result column="borrowContractNo" property="borrowContractNo" jdbcType="VARCHAR" />
    
    <result column="apr" property="apr"/>
    <result column="BORROWTYPE" property="borrowtype" />
	<result column="TIME_LIMIT" property="timeLimit"  />
	<result column="style" property="style"/>
    
    
  </resultMap>
  
      <!-- 根据直通车ID查询投标记录 -->
   <select id="queryTenderBorrow" resultMap="tenderRecordVoResultMap" parameterType="java.lang.Integer" >
    select b.`NAME` as firstBorrowName,FROM_UNIXTIME(t.`ADDTIME`,'%Y-%m-%d %H:%i:%s')addtime,b.style,b.`APR`,b.BORROWTYPE,b.TIME_LIMIT,t.ID, t.USER_ID, t.BORROW_ID, b.STATUS, t.ACCOUNT, t.INTEREST, t.REPAYMENT_ACCOUNT, t.REPAYMENT_YESACCOUNT, 
    t.REPAYMENT_YESINTEREST, t.ADDIP,  t.TENDER_TYPE,  t.AUTOTENDER_ORDER,  t.AUTOTENDER_ORDER_REMARK, 
     t.FIRST_BORROW_ID,  t.FIRST_BORROW_SCALE,  t.USER_LEVEL,  t.RATIO from rocky_b_tenderrecord t 
	left join rocky_borrow b on b.ID = t.BORROW_ID
	WHERE FIRST_TENDER_REAL_ID =#{realId} and b.status in (4,5) and t.`STATUS` in (1,2) order by  b.`ADDTIME` desc
  </select>
  
  
  
  <sql id="tender_record_column_List" >
    t.ID, t.USER_ID, t.BORROW_ID, t.STATUS, t.ACCOUNT, t.INTEREST, t.REPAYMENT_ACCOUNT, t.REPAYMENT_YESACCOUNT, 
    t.REPAYMENT_YESINTEREST, t.ADDTIME, t.ADDIP, t.TENDER_TYPE, t.AUTOTENDER_ORDER, t.AUTOTENDER_ORDER_REMARK, 
    t.FIRST_BORROW_ID, t.FIRST_BORROW_SCALE, t.USER_LEVEL, t.RATIO,t.E_FREEZE_No,t.E_FREEZE_DATE,t.E_BANKINFO_ID,t.BIZ_FREEZE_NO,t.E_INVEST_No,t.E_INVEST_STATUS,t.E_INVEST_DATE,t.BIZ_INVEST_NO,t.IS_CUSTODY
  </sql>

	<!-- 封装查询条件 -->
	<sql id="tender_record_Where_Clause">
		<if test="id != null">
			and t.id =#{id}
		</if>
		<if test="borrowId != null">
			and t.BORROW_ID =#{borrowId}
		</if>		
		<if test="status != null">
			and t.STATUS = #{status}
		</if>
	</sql>
  
  <!-- 根据borrowId查询投标记录 -->
  <select id="queryTenderRecordByBorrowId" parameterType="java.lang.Integer" resultMap="tenderRecordVoResultMap" >
    SELECT 
    	<include refid="tender_record_column_List" />,
	    m.username username,
	    m.email email,
	    tb.`NAME` as firstBorrowName,
	    from_unixtime(t.addtime) addtime_date
	FROM 
		ROCKY_B_TENDERRECORD t 
	left join 
		ROCKY_MEMBER m on m.id = t.user_id 
	LEFT JOIN 
		t_first_borrow tb ON t.FIRST_BORROW_ID = tb.ID 
	WHERE 
		t.BORROW_ID= #{borrowId} 
	ORDER BY 
		t.addtime desc,
		t.id asc
  </select>
  
    <!-- 根据投标条件查询投标记录 --> 
  <select id="queryListByTenderRecordCnd" parameterType="com.dxjr.portal.borrow.vo.TenderRecordCnd" resultMap="tenderRecordVoResultMap" >
    SELECT 
    	<include refid="tender_record_column_List" />,
	    m.username username,
	    m.email email,
	    tb.`NAME` as firstBorrowName,
	    from_unixtime(t.addtime) addtime_date
	FROM 
		ROCKY_B_TENDERRECORD t 
	left join 
		ROCKY_MEMBER m on m.id = t.user_id 
	LEFT JOIN 
		t_first_borrow tb ON t.FIRST_BORROW_ID = tb.ID 
	WHERE 1=1
	<if test="borrowId!=null">
	   and t.BORROW_ID= #{borrowId} 
	</if>
	<if test="recordType!=null">
		<if test="recordType ==0">
			and t.PARENT_ID is null
			and t.STATUS !=-1 
		</if>	
		<if test="recordType ==1">
			and t.status !=-2 
		</if>		
	</if>		
	ORDER BY t.id desc
  </select>
  
    <!-- 根据borrowId查询投标记录 ==分页功能 -->
  <select id="queryTenderRecordPage" parameterType="java.lang.Integer" resultType="com.dxjr.portal.borrow.vo.TenderRecordVo" >
	select
	  t.ID,
	  if(t.TENDER_TYPE = 3, ftu.ACCOUNT, t.ACCOUNT) as account,
	  t.ADDTIME,
	  t.TENDER_TYPE as tenderType,
	  t.AUTOTENDER_ORDER as autotenderOrder,
	  t.FIRST_BORROW_ID as firstBorrowId,
	  t.FIRST_BORROW_SCALE as firstBorrowScale,
	  ifnull(m.ID, ftu.USER_ID) as userId,
	  ifnull(m.USERNAME, ftu.USERNAME) as username,
	  tb.PERIODS as firstPeriods,
	  ifnull(tb.`NAME`, fb.CONTRACT_NO) as firstBorrowName,
	  t.PLATFORM,
	  if(t.TENDER_TYPE = 3, ftu.USER_LEVEL, t.USER_LEVEL) as userLevel,
	  t.IS_CUSTODY as isCustody,
	  CASE WHEN fc.ID is null THEN 0 ELSE 1 END AS ishowfloat,
	  fc.APR_YEAR AS yearApr,
	  ifnull(m.USERIDMD5, (select USERIDMD5 from rocky_member where id=ftu.USER_ID limit 1)) as userIdMD5
	from rocky_b_tenderrecord t
	left join rocky_member m on m.ID = t.USER_ID
	left join t_first_borrow tb on tb.ID = t.FIRST_BORROW_ID
	left join t_fix_borrow fb on fb.ID = t.USER_ID
	left join t_fix_tender_user ftu on ftu.TENDER_ID = t.ID and ftu.FIX_BORROW_ID = fb.ID and ftu.`STATUS` != 2
    left join t_float_coupon fc on t.ID = fc.TARGET_ID and t.USER_ID = fc.USER_ID and fc.TARGET_TYPE = 1 and fc.TYPE = 1 and fc.STATUS = 1 and fc.IS_CUSTODY != 1
	where t.BORROW_ID = #{borrowId}
	and t.PARENT_ID is null
	and t.`STATUS` != -1
	order by t.ID desc, ftu.ID asc
  </select>
  
  <!-- 根据borrowId获取最后一笔投标记录 -->
  <select id="queryTenderRecordLastByBorrowId" parameterType="java.lang.Integer" resultMap="tenderRecordVoResultMap" >
    SELECT <include refid="tender_record_column_List" />
	FROM ROCKY_B_TENDERRECORD t 
	WHERE t.BORROW_ID= #{borrowId} order by t.id desc limit 0,1
  </select>
  
  <!-- 根据borrowId查询投标记录数 -->
  <select id="queryTenderRecordCountByBorrowId" parameterType="java.lang.Integer" resultType="java.lang.Integer" >
	select count(1)
	from rocky_b_tenderrecord t
	left join rocky_member m on m.ID = t.USER_ID
	left join t_first_borrow tb on tb.ID = t.FIRST_BORROW_ID
	left join t_fix_borrow fb on fb.ID = t.USER_ID
	left join t_fix_tender_user ftu on ftu.TENDER_ID = t.ID and ftu.FIX_BORROW_ID = fb.ID and ftu.`STATUS` != 2
    left join t_float_coupon fc on t.ID = fc.TARGET_ID and t.USER_ID = fc.USER_ID and fc.TARGET_TYPE = 1 and fc.TYPE = 1 and fc.STATUS = 1 and fc.IS_CUSTODY != 1
	where t.BORROW_ID = #{borrowId}
	and t.PARENT_ID is null
	and t.`STATUS` != -1
  </select>
  
  	<!-- 取得有效投标金额 -->
  <select id="saveManualTender" resultType="java.math.BigDecimal">  
      SELECT isEffectiveMoney(#{borrowId},#{userId},#{money},'0',0) FROM DUAL
   </select>
   
   <select id="getTenderAccountYesByBorrowId" parameterType="java.lang.Integer" resultType="java.math.BigDecimal" >
    SELECT SUM(ACCOUNT) FROM rocky_b_tenderrecord where BORROW_ID = #{borrowId}
  </select>
  
  
  <select id="getEffectMoney" parameterType="java.lang.Integer" resultType="java.math.BigDecimal" >
    
  </select>
  
  	  	<!-- 根据条件查询投标记录集合-->
	<select id="queryTenderListByCnd" parameterType="com.dxjr.portal.tender.vo.BTenderRecordCnd" resultMap="tenderRecordVoResultMap" >
		SELECT
		     <include refid="tender_record_column_List" />
		FROM ROCKY_B_TENDERRECORD t
		where 1=1
	    <include refid="tender_record_Where_Clause"/>
		<if test="lockedRecordYn != null and lockedRecordYn == 'yes'">
			FOR UPDATE
		</if>		
  	</select>
  	
  	<!-- 根据userId查询投官方标的投标记录数量 -->
  	<select id="getTenderRecordCountByUserId" parameterType="java.lang.Integer" resultType="java.lang.Integer" >
    	 SELECT count(t.id) FROM rocky_b_tenderrecord t, rocky_borrow b where t.USER_ID = #{userId} AND t.BORROW_ID = b.ID AND b.BORROWTYPE in(1,2,5)
    </select>
    
    <!-- 根据userId查询投标成功的数量 -->
  	<select id="getTenderSuccessCountByUserId" parameterType="java.lang.Integer" resultType="java.lang.Integer" >
    	 SELECT count(t.id) FROM rocky_b_tenderrecord t where t.USER_ID = #{userId} AND t.`STATUS` != -1 AND t.`STATUS` != 0
    </select>
    
    <!-- 根据userId查询投过散标的数量（即仅手动投标和自动投标） -->
  	<select id="getTenderPowderCountByUserId" parameterType="java.lang.Integer" resultType="java.lang.Integer" >
    	 SELECT count(t.id) FROM rocky_b_tenderrecord t where t.USER_ID = #{userId} and TENDER_TYPE in(0,1)
    </select>
    
    <!-- 查询userId和account查询该用户所投最后一笔投标记录 -->
    <select id="queryTenderRecordLastByUserIdAndAccount" resultMap="tenderRecordVoResultMap" >
    SELECT <include refid="tender_record_column_List" />
	FROM ROCKY_B_TENDERRECORD t 
	WHERE t.BORROW_ID= #{borrowId} AND t.USER_ID = #{userId} AND t.ACCOUNT = #{account} order by t.id desc limit 1
  </select>
  
  <!-- 根据定期宝ID查询投标记录表信息--> 
  <select id="queryFixTenderRecordList" parameterType="java.lang.Integer" resultMap="tenderRecordVoResultMap" >
	SELECT  <include refid="tender_record_column_List" />,
			rb.CONTRACT_NO AS borrowContractNo ,
			ifnull(Sum(rbc.CAPITAL),0)  AS tenderCapital ,
			ifnull(Sum(rbc.INTEREST),0) AS tenderInterest ,
			ifnull(Sum(rbc.REPAY_ACCOUNT),0) AS tenderRepayAccount
	FROM rocky_b_tenderrecord t
	inner join rocky_b_collectionrecord rbc on rbc.TENDER_ID = t.ID
	  and rbc.`STATUS` = 0
	inner join rocky_borrow rb on rbc.BORROW_ID = rb.ID
	WHERE t.USER_ID = #{fixBorrowId}
	  AND t.`STATUS` = 1
	group by t.ID;
  </select>
  
  
  <insert id="insertTenderrecord" parameterType="com.dxjr.portal.borrow.entity.TenderRecord" >
  	INSERT INTO rocky_b_tenderrecord (USER_ID, BORROW_ID, ACCOUNT, INTEREST, REPAYMENT_ACCOUNT, REPAYMENT_YESACCOUNT, REPAYMENT_YESINTEREST, ADDTIME, ADDIP, TENDER_TYPE, IS_VIP,RATIO,USER_LEVEL,PLATFORM,IS_CUSTODY,E_FREEZE_No,E_BANKINFO_ID,E_INVEST_STATUS,E_FREEZE_DATE,BIZ_INVEST_NO,BIZ_FREEZE_NO) 
  		VALUES ( #{userId},#{borrowId},#{account},#{interest},#{account}+#{interest},0,0,unix_timestamp(),#{addip}, '0', #{isVip},${ratio},${userLevel},${platform},#{isCustody},#{eFreezeNo},#{eBankInfoId},#{eInvestStatus},#{eFreezeDate},#{bizInvestNo},#{bizFreezeNo})
  	
  	 <selectKey resultType="java.lang.Integer" order="AFTER" keyProperty="id">  
      	    SELECT LAST_INSERT_ID() AS ID    
   	 </selectKey>
  
  </insert>
  
  <select id="getFqInsTotal" resultType="java.math.BigDecimal" parameterType="java.util.Map">
  <![CDATA[  
 	 select getFqInsTotal(#{money},#{apr},#{limit}) from dual
  ]]>
  </select>
  
  <select id="getUserLevelRatio" statementType="CALLABLE" parameterType="java.util.Map" resultType="java.util.Map">
  <![CDATA[  
  {CALL getUserLevelRatio(#{userId,mode=IN,jdbcType=INTEGER},#{userLevel,mode=OUT,jdbcType=VARCHAR},#{ratio,mode=OUT,jdbcType=VARCHAR},#{syceeRatio,mode=OUT,jdbcType=VARCHAR})}
   ]]>
  </select>
  
  <select id="findTenderrecordAccount" resultType="com.dxjr.portal.borrow.vo.TenderRecordVo" parameterType="java.lang.Integer">
   select sum(ACCOUNT) as sumAccount,count(id) as tenderCount from rocky_b_tenderrecord where BORROW_ID=#{borrowId}
  </select>
  
  <select id="findTenderrecordForUpdate" parameterType="java.lang.Integer" resultMap="BaseResultMap">
  	select   <include refid="tender_record_column_List" />
  	from rocky_b_tenderrecord t where t.BORROW_ID=#{borrowId} for update
  </select>
  
  <update id="updateTenderrecordZS" parameterType="com.dxjr.portal.borrow.entity.TenderRecord" >
  update rocky_b_tenderrecord
  <set>
  	<if test="bizInvestNo!=null and bizInvestNo!=''">
  	 BIZ_INVEST_NO=#{bizInvestNo},
  	</if>
  	<if test="eInvestDate!=null and eInvestDate!=''">
  	E_INVEST_DATE=#{eInvestDate},
  	</if>
  	<if test="eInvestNo!=null and eInvestNo!=''">
  	E_INVEST_No=#{eInvestNo},
  	</if>
  	<if test="eInvestStatus!=null and eInvestStatus!=''">
  	E_INVEST_STATUS=#{eInvestStatus}
  	</if>
  </set>
  where id=#{id}
  </update>
  
  <!-- 查询该用户是否有正在审核中的标 -->
  <select id="findCheckBorrow" resultType="java.lang.Integer" parameterType="java.lang.Integer">
  	SELECT COUNT(rbt.ID) FROM rocky_b_tenderrecord rbt 
	INNER JOIN rocky_borrow rb ON rbt.BORROW_ID=rb.ID 
	WHERE rbt.USER_ID=#{userId} AND rb.`STATUS` IN(6,7)
  </select>
  
</mapper>